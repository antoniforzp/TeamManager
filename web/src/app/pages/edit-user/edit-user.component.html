<app-menu></app-menu>

<div class="d-flex">

    <div class="my-page-side-container my-container-menu">

        <ng-container *ngIf="pageLoaded; else loading">

            <!-- ERROR HANDLING -->
            <div *ngIf="pageError">
                <app-error [error]="pageError"></app-error>
            </div>

            <!-- PAGE CONTENT -->
            <div *ngIf="!pageError">

                <app-page-header [header]="'Edytuj użytkownika'" [goBackUrl]="'/home'"></app-page-header>

                <form [formGroup]="credentialsForm">

                    <!-- CREDENTIALS -->
                    <div class="form-group">
                        <h5>Dane osobowe</h5>

                        <!-- Name -->
                        <div class="row mb-2">
                            <label for="name" class="col-sm-3 col-form-label required">Imię</label>
                            <div class="col-sm-9">
                                <input id="name" type="text" class="form-control" formControlName="userName">

                                <!-- Errors -->
                                <div class="d-flex flex-column" *ngIf="userName.errors && userName.dirty">
                                    <small class="alert-danger" *ngIf="userName.hasError('required')">Pole
                                        wymagane</small>
                                </div>
                            </div>
                        </div>

                        <!-- Surname -->
                        <div class="row mb-2">
                            <label for="surname" class="col-sm-3 col-form-label required">Nazwisko</label>
                            <div class="col-sm-9">
                                <input id="surname" type="text" class="form-control" formControlName="userSurname">

                                <div class="d-flex flex-column" *ngIf="userSurname.errors && userSurname.dirty">
                                    <small class="alert-danger" *ngIf="userSurname.hasError('required')">Pole
                                        wymagane</small>
                                </div>
                            </div>
                        </div>

                        <!-- Email -->
                        <div class="row mb-2">
                            <label for="email" class="col-sm-3 col-form-label">Email</label>
                            <div class="col-sm-9">
                                <input id="email" type="text" class="form-control" formControlName="userEmail">

                                <!-- Errors -->
                                <div class="d-flex flex-column" *ngIf="userEmail.errors && userEmail.dirty">
                                    <small class="alert-danger" *ngIf="userEmail.hasError('required')">Pole
                                        wymagane</small>
                                    <small class="alert-danger" *ngIf="userEmail.hasError('pattern')">Nieprawidłowy
                                        format
                                        adresu
                                        email. Poprawny: email@email.com</small>
                                </div>
                            </div>
                        </div>

                        <div class="d-flex justify-content-end">
                            <!-- SUBMIT BUTTON -->
                            <button type="button" class="btn btn-primary button-add-user my-button" type="submit"
                                (click)="editCredentials()" [disabled]="!credentialsForm.valid">Edytuj</button>
                        </div>

                    </div>
                </form>

                <form [formGroup]="passwordsForm">

                    <!-- PASSWORD -->
                    <div class="form-group">
                        <h5>Dane logowania</h5>

                        <!-- Current password -->
                        <div class="row mb-2">
                            <label for="passwordCurrent" class="col-sm-3 col-form-label required">Obecne
                                hasło</label>
                            <div class="col-sm-9">
                                <input id="passwordCurrent" type="password" class="form-control"
                                    formControlName="passwordCurrent">

                                <!-- Errors -->
                                <div class="d-flex flex-column"
                                    *ngIf="passwordCurrent.hasError('required') && passwordCurrent.dirty">
                                    <small class="alert-danger">Pole
                                        wymagane</small>
                                </div>
                                <div class="d-flex flex-column" *ngIf="validCurrentPassword === false">
                                    <small class="alert-danger">Hasło
                                        nieprawidłowe</small>
                                </div>
                            </div>
                        </div>

                        <!-- password -->
                        <div class="row mb-2">
                            <label for="password" class="col-sm-3 col-form-label required">Nowe hasło</label>
                            <div class="col-sm-9">
                                <input id="password" type="password" class="form-control" formControlName="passwordNew">

                                <!-- Errors -->
                                <div class="d-flex flex-column" *ngIf="passwordNew.errors && passwordNew.dirty">
                                    <small class="alert-danger" *ngIf="passwordNew.hasError('required')">Pole
                                        wymagane</small>
                                    <small class="alert-danger" *ngIf="passwordNew.hasError('hasNumber')">Hasło musi
                                        posiadać
                                        co
                                        najmniej
                                        jedną cyfrę</small>
                                    <small class="alert-danger" *ngIf="passwordNew.hasError('hasCapitalCase')">Hasło
                                        musi
                                        posiadać
                                        co
                                        najmniej jedną wielką literę</small>
                                    <small class="alert-danger" *ngIf="passwordNew.hasError('hasSmallCase')">Hasło
                                        musi
                                        posiadać co
                                        najmniej jedną małą literę</small>
                                    <small class="alert-danger" *ngIf="passwordNew.hasError('minLength')">Hasło musi
                                        posiadać
                                        co
                                        najmniej 8
                                        cyfr</small>
                                </div>
                            </div>
                        </div>

                        <!-- password repeat -->
                        <div class="row mb-2">
                            <label for="passwordRepeat" class="col-sm-3 col-form-label required">Powtórz
                                hasło</label>
                            <div class="col-sm-9">
                                <input id="passwordRepeat" type="password" class="form-control"
                                    formControlName="passwordRepeat">

                                <!-- Errors -->
                                <div class="d-flex flex-column"
                                    *ngIf="(passwordRepeat.errors || passwordsForm.errors) && passwordRepeat.dirty">
                                    <small class="alert-danger" *ngIf="passwordRepeat.hasError('required')">Pole
                                        wymagane</small>
                                    <small class="alert-danger"
                                        *ngIf="passwordsForm.hasError('passwordDifferent')">Hasła
                                        się
                                        nie
                                        zgadzają</small>
                                </div>
                            </div>
                        </div>

                        <div class="d-flex justify-content-end">
                            <!-- SUBMIT BUTTON -->
                            <button type="button" class="btn btn-primary button-add-user my-button" type="submit"
                                (click)="editPassword()" [disabled]="!passwordsForm.valid">Edytuj</button>
                        </div>
                    </div>
                </form>
            </div>
        </ng-container>
    </div>

    <!-- LEFT POSTER -->
    <div class="my-page-side-poster"></div>
</div>

<app-footer></app-footer>

<ng-template #loading>
    <app-page-spinner></app-page-spinner>
</ng-template>